{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Просмотр данных из базы данных</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
  <h1>Просмотр данных из базы данных</h1>

  <!-- Поле ввода для поиска по названию рецепта, ингредиентам, инструкции -->
  <input type="text" id="search" placeholder="Поиск по названию рецепта, ингредиентам, инструкции">

  <!-- Проверка наличия записей в базе данных -->
  {% if entries %}
  <table>
      <thead>
          <tr>
              <th>Название рецепта</th>
              <th>Ингредиенты</th>
              <th>Инструкции</th>
              <th>Время приготовления</th>
              <th>Действия</th>
          </tr>
      </thead>
      <tbody>
          <!-- Цикл для отображения каждой записи -->
          {% for entry in entries %}
          <tr>
              <!-- Ячейка с названием рецепта -->
              <td>{{ entry.name }}</td>
              <!-- Ячейка с ингредиентами -->
              <td>{{ entry.ingredients }}</td>
              <!-- Ячейка с инструкциями -->
              <td>{{ entry.instructions }}</td>
              <!-- Ячейка с временем приготовления -->
              <td>{{ entry.cooking_time }}</td>
              <td>
                  <!-- Кнопка редактирования -->
                  <a href="{% url 'edit_entry' entry.id %}">
                      <button>Редактировать</button>
                  </a>
                  <!-- Форма для удаления записи -->
                  <form method="POST" action="{% url 'delete_entry' entry.id %}" style="display:inline;">
                      {% csrf_token %} <!-- Токен CSRF для защиты формы -->
                      <button type="submit">Удалить</button> <!-- Кнопка удаления -->
                  </form>
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
  {% else %}
  <p>Нет данных для отображения</p>
  {% endif %}

  <!-- Блок с навигационными ссылками -->
  <div class="nav-links">
      <a href="{% url 'xml_form' %}" class="btn-link">Назад к форме</a>
  </div>
</body>

    <script>
        // Добавляем обработчик события 'input' к полю поиска
        document.getElementById('search').addEventListener('input', function() {
            // Получаем введенный пользователем текст из поля поиска
            let query = this.value;

            // Проверяем, пустое ли поле поиска
            if (query === '') {
                // Если поле пустое, показываем оригинальные данные таблицы
                window.location.reload(); // Перезагружаем страницу, чтобы показать оригинальные данные
            } else {
                // Выполняем AJAX-запрос для поиска
                fetch(`/search/?query=${query}`)
                    .then(response => response.json()) // Ожидаем ответ в формате JSON
                    .then(data => {
                        // Находим тело таблицы, в которое будем добавлять данные
                        let tableBody = document.querySelector('table tbody');

                        // Очищаем текущее содержимое таблицы перед добавлением новых данных
                        tableBody.innerHTML = '';

                        // Проходим по каждому элементу в полученных данных и добавляем их в таблицу
                        data.entries.forEach(entry => {
                            // Для каждого элемента создаем строку (tr) с ячейками (td)
                            tableBody.innerHTML += `
                                <tr>
                                    <td>${entry.name}</td> <!-- Название рецепта -->
                                    <td>${entry.ingredients}</td> <!-- Ингредиенты -->
                                    <td>${entry.instructions}</td> <!-- Инструкции -->
                                    <td>${entry.cooking_time}</td> <!-- Время приготовления -->
                                    <td>
                                        <!-- Кнопка редактирования -->
                                        <a href="/edit_entry/${entry.id}/">
                                            <button>Редактировать</button>
                                        </a>
                                        <!-- Кнопка удаления -->
                                        <form method="POST" action="/delete_entry/${entry.id}/" style="display:inline;">
                                            <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                            <button type="submit">Удалить</button>
                                        </form>
                                    </td>
                                </tr>`;
                        });
                    });
            }
        });
    </script>
</body>
</html>
